(window.webpackJsonp=window.webpackJsonp||[]).push([[81],{460:function(e,t,i){"use strict";i.r(t);var a=i(43),s=Object(a.a)({},(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[i("h1",{attrs:{id:"performance-workstream"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#performance-workstream"}},[e._v("#")]),e._v(" Performance Workstream")]),e._v(" "),i("p",[e._v("Wednesday, March 11, 2020")]),e._v(" "),i("h2",{attrs:{id:"performance-goals"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#performance-goals"}},[e._v("#")]),e._v(" Performance Goals:")]),e._v(" "),i("ul",[i("li",[e._v("Current HW system achieving stable 1k TPS, peak 5k and proven horizontal scalability\n"),i("ol",[i("li",[e._v("More instances = more performance in almost linear fashion.")]),e._v(" "),i("li",[e._v("Validate the minimum infrastructure to do 1K TPS (fin TPS)")]),e._v(" "),i("li",[e._v("Determine the entry level configuration and cost (AWS and on-premise)")])])])]),e._v(" "),i("h2",{attrs:{id:"pocs"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#pocs"}},[e._v("#")]),e._v(" POCs:")]),e._v(" "),i("p",[e._v("Test the impact or a direct replace of the mysql DB with an shared memory network service like redis (using redlock alg if locks are required)")]),e._v(" "),i("p",[e._v("Test a different method of sharing state, using a light version of event-drive with some CQRS")]),e._v(" "),i("h2",{attrs:{id:"resources"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#resources"}},[e._v("#")]),e._v(" Resources:")]),e._v(" "),i("ul",[i("li",[e._v("Slack Channel: "),i("code",[e._v("#perf-engineering")])]),e._v(" "),i("li",[i("a",{attrs:{href:"https://github.com/mojaloop/documentation-artifacts/tree/master/presentations/March2020-PI9-MidPI-Review",target:"_blank",rel:"noopener noreferrer"}},[e._v("Mid-PI performance presentation"),i("OutboundLink")],1)]),e._v(" "),i("li",[i("a",{attrs:{href:"https://github.com/mojaloop/helm/tree/master/monitoring",target:"_blank",rel:"noopener noreferrer"}},[e._v("Setting up the monitoring components"),i("OutboundLink")],1)])]),e._v(" "),i("h2",{attrs:{id:"action-follow-up-items"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#action-follow-up-items"}},[e._v("#")]),e._v(" Action/Follow-up Items:")]),e._v(" "),i("ul",[i("li",[i("p",[e._v("What Kafka metrics (client & server side) should we be reviewing? - Confluent to assist")])]),e._v(" "),i("li",[i("p",[e._v("Explore Locking and position settlement - Sybrin to assist")]),e._v(" "),i("ol",[i("li",[e._v("Review RedLock - pessimistic locking vs automatic locking")]),e._v(" "),i("li",[e._v("Remove the shared DB in the middle (automatic locking on Reddis)")])])]),e._v(" "),i("li",[i("p",[e._v("Combine prepare/position handler w/ distributed DB")])]),e._v(" "),i("li",[i("p",[e._v("Review node.js client and how it impact kafka, configuration of Node and ultimate Kafka client - Nakul")])]),e._v(" "),i("li",[i("p",[e._v("Turn back on tracing to see how latency and applications are behaving")])]),e._v(" "),i("li",[i("p",[e._v("Ensure the call counts have been rationalized (at a deeper level)")])]),e._v(" "),i("li",[i("p",[e._v("Validate the processing times on the handlers and we are hitting the cache")])]),e._v(" "),i("li",[i("p",[e._v("Async patterns in Node")]),e._v(" "),i("ol",[i("li",[e._v("Missing someone who is excellent on mysql and percona")]),e._v(" "),i("li",[e._v("Are we leveraging this correctly")])])]),e._v(" "),i("li",[i("p",[e._v("What cache layer are we using (in memory)")])]),e._v(" "),i("li",[i("p",[e._v("Review the event modeling implementation - identify the domain events")])]),e._v(" "),i("li",[i("p",[e._v("Node.js/kubernetes -")])]),e._v(" "),i("li",[i("p",[e._v("Focus on application issues not as much as arch issues")])]),e._v(" "),i("li",[i("p",[e._v("How we are doing async technology - review this (Node.JS - larger issue) threaded models need to be optimize - Nakul")])])]),e._v(" "),i("h2",{attrs:{id:"meeting-notes-details"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#meeting-notes-details"}},[e._v("#")]),e._v(" Meeting Notes/Details")]),e._v(" "),i("h3",{attrs:{id:"history"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#history"}},[e._v("#")]),e._v(" History")]),e._v(" "),i("ol",[i("li",[i("p",[e._v("Technology has been put in place, hoped the design solves an enterprise problem")])]),e._v(" "),i("li",[i("p",[e._v("Community effort did not prioritize on making the slices of the system enterprise grade or cheap to run")])]),e._v(" "),i("li",[i("p",[e._v("OSS technology choices")])])]),e._v(" "),i("h3",{attrs:{id:"goals"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#goals"}},[e._v("#")]),e._v(" Goals")]),e._v(" "),i("ol",[i("li",[e._v("Optimize current system")]),e._v(" "),i("li",[e._v("Make it cheaper to run")]),e._v(" "),i("li",[e._v("Make it scalable to 5K TPS")]),e._v(" "),i("li",[e._v("Ensure value added services can effectively and securely access transaction data")])]),e._v(" "),i("h3",{attrs:{id:"testing-constraints"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#testing-constraints"}},[e._v("#")]),e._v(" Testing Constraints")]),e._v(" "),i("ol",[i("li",[e._v("Only done the golden transfer - transfer leg")]),e._v(" "),i("li",[e._v("Flow of transfer")]),e._v(" "),i("li",[e._v("Simulators (legacy and advance) - using the legacy one for continuity")]),e._v(" "),i("li",[e._v("Disabled the timeout handler")]),e._v(" "),i("li",[e._v("8 DFSP (participant organizations) w/ more DFSPs we would be able to scale")])]),e._v(" "),i("h3",{attrs:{id:"process"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#process"}},[e._v("#")]),e._v(" Process")]),e._v(" "),i("ol",[i("li",[i("p",[e._v("Jmeter initiates payer request")])]),e._v(" "),i("li",[i("p",[e._v("Legacy simulator Receives fulfill notify callback")])]),e._v(" "),i("li",[i("p",[e._v("Legacy simulator Handles Payee processing, initiatives Fulfillment Callback")])]),e._v(" "),i("li",[i("p",[e._v("Record in the positions table for each DFSP")]),e._v(" "),i("ul",[i("li",[e._v("a. Partial algorithm where the locking is done to reserve the funds, do calculations and do the final commits")]),e._v(" "),i("li",[e._v("b. Position handler is Processing one record at a time")])])]),e._v(" "),i("li",[i("p",[e._v("Future algorithm would do a bulk")])])]),e._v(" "),i("ul",[i("li",[e._v("One transfer is handler by one position handler\n"),i("ul",[i("li",[e._v("Transfers are all pre-funded")])])])]),e._v(" "),i("ol",[i("li",[e._v("Reduced settlement costs")]),e._v(" "),i("li",[e._v("Can control how fast DFSPs respond to the fulfill request (complete the transfers committed first before handling new requests)")])]),e._v(" "),i("ul",[i("li",[i("p",[e._v("System need to timeout transfers that go longer then 30 seconds")]),e._v(" "),i("ul",[i("li",[e._v("Any redesign of the DBs")]),e._v(" "),i("li",[e._v("Test Cases")])])]),e._v(" "),i("li",[i("p",[e._v("Financial transaction")]),e._v(" "),i("ul",[i("li",[e._v("End-to-end")]),e._v(" "),i("li",[e._v("Prepare-only")]),e._v(" "),i("li",[e._v("Fulfil only")])])]),e._v(" "),i("li",[i("p",[e._v("Individual Mojaloop Characterization")]),e._v(" "),i("ul",[i("li",[e._v("Services & Handlers")]),e._v(" "),i("li",[e._v("Streaming Arch & Libraries")]),e._v(" "),i("li",[e._v("Database")]),e._v(" "),i("li",[e._v("What changed: 150 to 300 TPS?")])])]),e._v(" "),i("li",[i("p",[e._v("How we process the messages")])]),e._v(" "),i("li",[i("p",[e._v("Position handler (run in mixed mode, random")]),e._v(" "),i("ul",[i("li",[e._v("Latency Measurement")])])])]),e._v(" "),i("ol",[i("li",[e._v("5 sec for DB to process, X sec for Kafka to process")]),e._v(" "),i("li",[e._v("How to measure this?")])]),e._v(" "),i("h3",{attrs:{id:"targets"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#targets"}},[e._v("#")]),e._v(" Targets")]),e._v(" "),i("ol",[i("li",[e._v("High enough the system has to function well")]),e._v(" "),i("li",[e._v("Crank the system up to add scale (x DFSPs addition)")]),e._v(" "),i("li",[e._v("Suspicious cases for investigations")]),e._v(" "),i("li",[e._v("Observing contentions around the DB")]),e._v(" "),i("li",[e._v("Shared DB, 600MS w/ out any errors")])]),e._v(" "),i("ul",[i("li",[i("p",[e._v("Contention is fully on the DB")])]),e._v(" "),i("li",[i("p",[e._v("Bottleneck is the DB (distribute systems so they run independently")])]),e._v(" "),i("li",[i("p",[e._v("16 databases run end to end")])]),e._v(" "),i("li",[i("p",[e._v("GSMA - 500 TPS")])]),e._v(" "),i("li",[i("p",[e._v("What is the optimal design?")])])]),e._v(" "),i("h3",{attrs:{id:"contentions"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#contentions"}},[e._v("#")]),e._v(" Contentions")]),e._v(" "),i("ol",[i("li",[i("p",[e._v("System handler contention")]),e._v(" "),i("ul",[i("li",[e._v("Where the system can be scaled")])])]),e._v(" "),i("li",[i("p",[e._v("If there are arch changes that we need to make we can explore this")]),e._v(" "),i("ul",[i("li",[e._v("Consistency for each DFSP")]),e._v(" "),i("li",[e._v("Threading of info flows - open question")])])]),e._v(" "),i("li",[i("p",[e._v("Sku'ed results of single DB for all DFSPs")])]),e._v(" "),i("li",[i("p",[e._v("Challenge is where get to with additional HW")]),e._v(" "),i("ul",[i("li",[e._v("What are the limits of the application design")])])]),e._v(" "),i("li",[i("p",[e._v("Financial transfers (in and out of the system)")]),e._v(" "),i("ul",[i("li",[e._v("Audit systems")]),e._v(" "),i("li",[e._v("Settlement activity")]),e._v(" "),i("li",[e._v("Grouped into DB solves some issues")]),e._v(" "),i("li",[e._v("Confluent feedback")])])]),e._v(" "),i("li",[i("p",[e._v("Shared DB issues, multiple DBs")])]),e._v(" "),i("li",[i("p",[e._v("Application design level issues")])]),e._v(" "),i("li",[i("p",[e._v("Seen situations where we ran a bunch of simulators/sandboxes")]),e._v(" "),i("ul",[i("li",[e._v("Need to rely on tracers and scans once this gets in productions")]),e._v(" "),i("li",[e._v("Miguel states we disable tracing for now")])])])]),e._v(" "),i("h3",{attrs:{id:"known-issues"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#known-issues"}},[e._v("#")]),e._v(" Known Issues")]),e._v(" "),i("ol",[i("li",[e._v("Load CPU resources on boxes (node waiting around) - reoptimize code")]),e._v(" "),i("li",[e._v("Processing times increase over time")])]),e._v(" "),i("h2",{attrs:{id:"optimization"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#optimization"}},[e._v("#")]),e._v(" Optimization")]),e._v(" "),i("ol",[i("li",[e._v("Distributed monolithic - PRISM - getting rid of redundant reads")]),e._v(" "),i("li",[e._v("Combine the handlers - Prepare+Position & Fulfil+Position")])]),e._v(" "),i("h3",{attrs:{id:"what-are-we-trying-to-fix"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#what-are-we-trying-to-fix"}},[e._v("#")]),e._v(" What are we trying to fix?")]),e._v(" "),i("ol",[i("li",[e._v("Can we scale the system?")]),e._v(" "),i("li",[e._v("What does this cost to do this? (scale unit cost)")]),e._v(" "),i("li",[e._v("Need to understand  - how to do this from a small and large scale")]),e._v(" "),i("li",[e._v("Optimized the resources")]),e._v(" "),i("li",[e._v("2.5 sprints")]),e._v(" "),i("li",[e._v("Need to scale horizontal")]),e._v(" "),i("li",[e._v("Add audit and repeatability -")])]),e._v(" "),i("h3",{attrs:{id:"attendees"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#attendees"}},[e._v("#")]),e._v(" Attendees:")]),e._v(" "),i("ul",[i("li",[e._v("Don, Joran (newly hired perf expert) - Coil")]),e._v(" "),i("li",[e._v("Sam, Miguel, Roman, Valentine, Warren, Bryan, Rajiv - ModusBox")]),e._v(" "),i("li",[e._v("Pedro - Crosslake")]),e._v(" "),i("li",[e._v("Rhys, Nakul Mishra - Confluent")]),e._v(" "),i("li",[e._v("Miller - Gates Foundation")]),e._v(" "),i("li",[e._v("In-person: Lewis (CL), Rob (MB), Roland (Sybrin), Greg (Sybrin), Megan (V), Simeon (V), Kim (CL)")])])])}),[],!1,null,null,null);t.default=s.exports}}]);