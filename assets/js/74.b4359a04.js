(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{448:function(e,t,a){"use strict";a.r(t);var s=a(43),n=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"migration-from-helm-v2-to-v3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#migration-from-helm-v2-to-v3"}},[e._v("#")]),e._v(" Migration from Helm v2 to v3")]),e._v(" "),a("p",[a("em",[e._v("Note: It is recommended that you upgrate from Helm v2 to v3 as v2 is at end-of-life. Refer to "),a("RouterLink",{attrs:{to:"/deployment-guide/helm-legacy-deployment.html"}},[e._v("Deployment with (Deprecated) Helm v2")]),e._v(" if you still require information on using Helm v2.")],1)]),e._v(" "),a("p",[e._v("This document provides instructions on how to migrate existing Mojaloop installations from Helm v2 to v3, and is based of the official Helm ("),a("a",{attrs:{href:"https://helm.sh/docs/topics/v2_v3_migration/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Migrating Helm v2 to v3"),a("OutboundLink")],1),e._v(") document.")]),e._v(" "),a("h2",{attrs:{id:"deployment-and-setup"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#deployment-and-setup"}},[e._v("#")]),e._v(" Deployment and Setup")]),e._v(" "),a("h4",{attrs:{id:"_1-helm-configuration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-helm-configuration"}},[e._v("#")]),e._v(" 1. Helm configuration")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("Install Helm v3")]),e._v(" "),a("p",[e._v("Follow the "),a("a",{attrs:{href:"https://helm.sh/docs/intro/install/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Installation Helm"),a("OutboundLink")],1),e._v(" documentation to download and install Helm v3, but ensure to rename to binary as "),a("code",[e._v("helm3")]),e._v(" before storing it in your path (i.e. on linux moving it to the "),a("code",[e._v("usr/local/bin")]),e._v(" folder). This will ensure that the existing Helm v2 binary is still accessible.")])]),e._v(" "),a("li",[a("p",[e._v("Validate that Helm3 has been installed correctly\nRun the following command to ensure that it is functioning:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ helm3 repo list\nError: no repositories to show\n")])])]),a("p",[e._v("You should receive the following response "),a("code",[e._v("Error: no repositories to show")]),e._v(" which is expected, and indicates that the Helm3 binary is working.")])]),e._v(" "),a("li",[a("p",[e._v("Install the "),a("code",[e._v("helm-2to3")]),e._v(" plugin")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("helm3 plugin "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" https://github.com/helm/helm-2to3\n")])])]),a("p",[e._v("Run the following command to confirm the plugin installation:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ helm3 plugin list\nNAME  \tVERSION\tDESCRIPTION\n2to3  \t"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0.2")]),e._v(".0  \tmigrate and cleanup Helm v2 configuration and releases in-place to Helm v3\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Backup your exisitng Helm v2 data")]),e._v(" "),a("p",[e._v("Make a copy of your existing "),a("code",[e._v("~/.helm")]),e._v(" directory as the next ("),a("code",[e._v("move")]),e._v(") command will cause your Helm v2 configuration to be no longer available.")])]),e._v(" "),a("li",[a("p",[e._v("Run the following commands to migrate your existing local configuration")]),e._v(" "),a("p",[e._v("Try run a "),a("code",[e._v("dry-run")]),e._v(" to ensure that everything looks fine:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("helm3 2to3 move config --dry-run\n")])])]),a("p",[e._v("Assuming that there are no errors, you can proceed with the following command:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("helm3 2to3 move config\n")])])]),a("p",[e._v("Run the following to ensure that the configuration was properly migrated, and your prviously Helm v2 configured repo config is shown:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ helm3 repo list\nNAME            URL\nstable          https://kubernetes-charts.storage.googleapis.com\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("local")]),e._v("           http://127.0.0.1:8879/charts\nincubator       http://storage.googleapis.com/kubernetes-charts-incubator\nkiwigrid        https://kiwigrid.github.io\nelastic         https://helm.elastic.co\nkiwigrid        https://kiwigrid.github.io\nbitnami         https://charts.bitnami.com/bitnami\nmojaloop        http://mojaloop.io/helm/repo/\n")])])])])]),e._v(" "),a("h4",{attrs:{id:"_2-migrating-helm-installations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-migrating-helm-installations"}},[e._v("#")]),e._v(" 2. Migrating Helm Installations")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ helm list\n\nNAME    \tREVISION\tUPDATED                 \tSTATUS  \tCHART           \tAPP VERSION\tNAMESPACE\nmoja\t"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("       \tThu Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("14")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("15")]),e._v(":01:00 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("\tDEPLOYED\tmojaloop-10.4.0\tv10.4.0     \tdemo\n")])])]),a("p",[e._v("Dry-run the migration command to validate that everything looks fine:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ helm3 2to3 convert --dry-run moja\n"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("/11/14 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("15")]),e._v(":03:17 NOTE: This is "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" dry-run mode, the following actions will not be executed.\n"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("/11/14 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("15")]),e._v(":03:17 Run without --dry-run to take the actions described below:\n"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("/11/14 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("15")]),e._v(":03:17\n"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("/11/14 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("15")]),e._v(":03:17 Release "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"moja"')]),e._v(" will be converted from Helm v2 to Helm v3.\n"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("/11/14 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("15")]),e._v(":03:17 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("Helm "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" Release "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"moja"')]),e._v(" will be created.\n"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("/11/14 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("15")]),e._v(":03:17 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("Helm "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" ReleaseVersion "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"moja.v1"')]),e._v(" will be created.\n")])])]),a("p",[e._v("Run the migration command:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ helm3 2to3 convert moja\n"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("/11/14 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("15")]),e._v(":03:57 Release "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"moja"')]),e._v(" will be converted from Helm v2 to Helm v3.\n"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("/11/14 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("15")]),e._v(":03:57 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("Helm "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" Release "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"moja"')]),e._v(" will be created.\n"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("/11/14 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("15")]),e._v(":03:57 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("Helm "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" ReleaseVersion "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"moja.v1"')]),e._v(" will be created.\n"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("/11/14 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("15")]),e._v(":03:57 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("Helm "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" ReleaseVersion "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"moja.v1"')]),e._v(" created.\n"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("/11/14 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("15")]),e._v(":03:57 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("Helm "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" Release "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"moja"')]),e._v(" created.\n"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("/11/14 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("15")]),e._v(":03:57 Release "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"moja"')]),e._v(" was converted successfully from Helm v2 to Helm v3.\n"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("/11/14 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("15")]),e._v(":03:57 Note: The v2 release information still remains and should be removed to avoid conflicts with the migrated v3 release.\n"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("/11/14 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("15")]),e._v(":03:57 v2 release information should only be removed using "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("`")]),e._v("helm 2to3"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("`")])]),e._v(" cleanup and when all releases have been migrated over.\n")])])]),a("p",[e._v("Optionaly add "),a("code",[e._v("--delete-v2-releases")]),e._v(" to the above command if you do not wish to retain the release information for the existing Helm v2 installation. This can be cleaned up later using the "),a("code",[e._v("helm3 2to3 cleanup")]),e._v(".")]),e._v(" "),a("p",[e._v("Validate that the migration was successful:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ helm list\nNAME    \tREVISION\tUPDATED                 \tSTATUS  \tCHART           \tAPP VERSION\tNAMESPACE\nmoja\t"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("       \tThu Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("14")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("15")]),e._v(":01:00 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("\tDEPLOYED\tmojaloop-10.4.0\tv10.4.0     \tdemo\n\n$ helm3 list -n demo\nNAME    \tNAMESPACE\tREVISION\tUPDATED                             \tSTATUS  \tCHART           \tAPP VERSION\nmoja\tdemo \t"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("       \t"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("-11-14 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("13")]),e._v(":01:00.188487 +0000 UTC\tdeployed\tmojaloop-10.4.0\t"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("10.4")]),e._v(".0\n")])])]),a("h4",{attrs:{id:"_3-cleanup"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-cleanup"}},[e._v("#")]),e._v(" 3. Cleanup")]),e._v(" "),a("p",[e._v("This section will show you how to remove Tiller and any existing configuration or metadata from existing Helm v2 deployments.")]),e._v(" "),a("p",[a("em",[e._v("NOTE: This may impact any Helm v2 deployments that have not been migrated. It is recommended that you only run these commands if you have migrated all existing Helm v2 to v3 deployments!")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ helm3 2to3 cleanup --dry-run\n"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("/11/14 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("15")]),e._v(":06:59 NOTE: This is "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" dry-run mode, the following actions will not be executed.\n"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("/11/14 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("15")]),e._v(":06:59 Run without --dry-run to take the actions described below:\n"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("/11/14 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("15")]),e._v(":06:59\nWARNING: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Helm v2 Configuration"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Release Data"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Release Data"')]),e._v(" will be removed.\nThis will clean up all releases managed by Helm v2. It will not be possible to restore them "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" you haven't made a backup of the releases.\nHelm v2 may not be usable afterwards.\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("Cleanup/confirm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" Are you sure you want to cleanup Helm v2 data? "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("y/N"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(": y\n"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("/11/14 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("15")]),e._v(":07:01\nHelm v2 data will be cleaned up.\n"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("/11/14 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("15")]),e._v(":07:01 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("Helm "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" Releases will be deleted.\n"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("/11/14 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("15")]),e._v(":07:01 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("Helm "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" ReleaseVersion "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"moja.v1"')]),e._v(" will be deleted.\n"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("/11/14 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("15")]),e._v(":07:01 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("Helm "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" Home folder "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"/Users/user/.helm"')]),e._v(" will be deleted.\n")])])]),a("p",[e._v("This will show a list of all what will be removed & deleted during the cleanup process:")]),e._v(" "),a("ul",[a("li",[e._v("Tiller service to be removed from kube-system namespace")]),e._v(" "),a("li",[e._v("Remote Helm v2 deployments")]),e._v(" "),a("li",[e._v("Local Helm v2 home configuration folder will be deleted")])]),e._v(" "),a("p",[e._v("If you are happy to proceed run the following command:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("helm3 2to3 cleanup\n")])])]),a("p",[e._v("If you no longer require Helm v2:")]),e._v(" "),a("ul",[a("li",[e._v("Uninstall Helm v2 from your local system")]),e._v(" "),a("li",[e._v("Rename the "),a("code",[e._v("helm3")]),e._v(" binary to "),a("code",[e._v("helm")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);