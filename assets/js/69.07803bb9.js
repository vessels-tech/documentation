(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{441:function(s,a,e){"use strict";e.r(a);var t=e(43),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"aws-cli"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#aws-cli"}},[s._v("#")]),s._v(" AWS CLI")]),s._v(" "),e("blockquote",[e("p",[s._v("Note: This document only relates to Mojaloop Devs with access to the private Mojaloop AWS Environment. If you think it belongs somewhere else, please let me know, or move it accordingly.")])]),s._v(" "),e("h2",{attrs:{id:"mfa"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mfa"}},[s._v("#")]),s._v(" MFA")]),s._v(" "),e("p",[s._v("Since the end of 2019, we have enforced MFA on all AWS Console Accounts (that is, accounts used by people). This has added some difficulty in using the AWS CLI tools, since aws cli commands will be rejected if a user has valid credentials, but hasn't also")]),s._v(" "),e("p",[s._v("In order to use the aws cli with MFA, you must create 'temporary credentials', that is, an "),e("code",[s._v("AWS_ACCESS_KEY_ID")]),s._v(" and "),e("code",[s._v("AWS_SECRET_ACCESS_KEY")]),s._v(" that is valid for a limited amount of time.")]),s._v(" "),e("h3",{attrs:{id:"using-aws-mfa"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#using-aws-mfa"}},[s._v("#")]),s._v(" Using aws-mfa")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/broamski/aws-mfa",target:"_blank",rel:"noopener noreferrer"}},[s._v("aws-mfa"),e("OutboundLink")],1),s._v(" is a python tool which helps manage the creation of new credentials automatically.")]),s._v(" "),e("p",[s._v("Follow the "),e("a",{attrs:{href:"https://github.com/broamski/aws-mfa#installation",target:"_blank",rel:"noopener noreferrer"}},[s._v("Installation guide"),e("OutboundLink")],1),s._v(" to install the tool and set up your "),e("code",[s._v("~/.aws/credentials")]),s._v(" and "),e("code",[s._v(".bashrc")]),s._v(" files accordingly.")]),s._v(" "),e("p",[s._v("For reference, this is what mine looks like:")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#~/.aws/credentials")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mojaloop-long-term"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\naws_access_key_id "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" NONE_OF\naws_secret_access_key "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" YOUR_BUSINESS\n")])])]),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#~/.bashrc")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("AWS_PROFILE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mojaloop\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MFA_DEVICE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("arn:aws:iam::"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("insert arn here"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MFA_STS_DURATION")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),s._v("\n")])])]),e("h3",{attrs:{id:"example"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#example"}},[s._v("#")]),s._v(" Example")]),s._v(" "),e("p",[s._v("For example, given a "),e("code",[s._v("~/.aws/credentials")]),s._v(" file of the following:")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[mojaloop]\naws_access_key_id = <insert_your_access_key_id>\naws_secret_access_key = <insert_your_secret_access_key>\n")])])]),e("p",[s._v("We can run a simple command to list all buckets ("),e("code",[s._v("aws s3 ls")]),s._v("), and see that it fails.")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ aws s3 "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nAn error occurred "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("AccessDenied"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" when calling the ListBuckets operation: Access Denied\n")])])]),e("p",[s._v("After setting up "),e("code",[s._v("aws-mfa")]),s._v(":")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ aws-mfa\nINFO - Validating credentials "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" profile: mojaloop\nINFO - Short term credentials section mojaloop is missing, obtaining new credentials.\nEnter AWS MFA code "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" device "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("arn:aws:iam::886403637725:mfa/lewis"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("renewing "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),s._v(" seconds"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":123456\nINFO - Fetching Credentials - Profile: mojaloop, Duration: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),s._v("\nINFO - Success"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" Your credentials will expire "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),s._v(" seconds at: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-02-07 07:33:08+00:00\n\n$ aws s3 "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-01-25 07:30:20 aws-logs-886403637725-us-west-2\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),s._v("-03-02 04:31:12 central-ledger-perf\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-04-23 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":48:21 central-services-perf-ecs-app-no-nat-assetsbucket-3wilcm5utbi\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),s._v("-02-01 03:37:24 cf-templates-1877qlmq9pnw-eu-central-1\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-12-07 04:02:04 circleci-bucket-76847d1f\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-02-09 01:36:43 devops-circleci-deployment-config\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-08-30 01:26:39 devops-circleci-jmpdev\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),s._v("-03-24 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":47:33 elasticbeanstalk-eu-central-1-886403637725\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),s._v("-05-12 04:03:10 elasticbeanstalk-us-east-1-886403637725\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),s._v("-02-25 06:36:17 elasticbeanstalk-us-east-2-886403637725\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2016")]),s._v("-11-19 09:30:11 elasticbeanstalk-us-west-1-886403637725\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2016")]),s._v("-09-02 09:14:52 elasticbeanstalk-us-west-2-886403637725\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),s._v("-03-21 00:22:23 l1p-metrics-processing\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-01-20 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":47:23 mojaloop-ci-reports\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-02-12 01:14:07 mojaloop-helm-repo\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-02-12 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":09:18 mojaloop-oss-qa-results\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-11-07 00:42:51 mojaloop-wso2-dependencies\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-11-08 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":53:45 oss-lab-performance-bucket-state\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);