(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{446:function(e,t,s){"use strict";s.r(t);var a=s(43),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"deployment-troubleshooting"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deployment-troubleshooting"}},[e._v("#")]),e._v(" Deployment Troubleshooting")]),e._v(" "),s("h2",{attrs:{id:"local-deployment-with-microk8s-suggestions"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#local-deployment-with-microk8s-suggestions"}},[e._v("#")]),e._v(" Local deployment with MicroK8s - suggestions:")]),e._v(" "),s("ul",[s("li",[e._v("use "),s("strong",[e._v("v1.15 of MicroK8s")]),e._v(' (higher version not yet supported) (details in "Installation of mojaloop helm charts fail with validation failed" section)')]),e._v(" "),s("li",[e._v("try "),s("code",[e._v("microk8s.inspect")]),e._v(' for hints (for example connectivity problems when ip forwarding is not enabled, more about it in "MicroK8s - Connectivity Issues section")')]),e._v(" "),s("li",[e._v("enable following microk8s add-ons (check with "),s("code",[e._v("sudo microk8s.status")]),e._v("):\n"),s("ul",[s("li",[e._v("storage")]),e._v(" "),s("li",[e._v("ingress")]),e._v(" "),s("li",[e._v("dns")]),e._v(" "),s("li",[e._v("istio")]),e._v(" "),s("li",[e._v("dashboard")])])])]),e._v(" "),s("h2",{attrs:{id:"_1-known-issues"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-known-issues"}},[e._v("#")]),e._v(" 1. Known issues")]),e._v(" "),s("h3",{attrs:{id:"_1-1-mojaloop-helm-charts-does-not-support-kubernetes-v1-16-or-greater"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-mojaloop-helm-charts-does-not-support-kubernetes-v1-16-or-greater"}},[e._v("#")]),e._v(" 1.1. Mojaloop Helm Charts does not support Kubernetes v1.16 or greater")]),e._v(" "),s("h4",{attrs:{id:"description"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#description"}},[e._v("#")]),e._v(" Description")]),e._v(" "),s("p",[e._v("When installing mojaloop helm charts, the following error occurs:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('Error: validation failed: [unable to recognize "": no matches for kind "Deployment" in version "apps/v1beta2", unable to recognize "": no matches for kind "Deployment" in version "extensions/v1beta1", unable to recognize "": no matches for kind "StatefulSet" in version "apps/v1beta2", unable to recognize "": no matches for kind "StatefulSet" in version "apps/v1beta1"]\n')])])]),s("h4",{attrs:{id:"reason"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reason"}},[e._v("#")]),e._v(" Reason")]),e._v(" "),s("p",[e._v("In version 1.16 of Kubernetes breaking change has been introduced (more about it "),s("a",{attrs:{href:"https://kubernetes.io/docs/setup/release/notes/#deprecations-and-removals",target:"_blank",rel:"noopener noreferrer"}},[e._v('in "Deprecations and Removals" of Kubernetes release notes'),s("OutboundLink")],1),e._v(". The  Kubernetes API versions "),s("code",[e._v("apps/v1beta1")]),e._v(" and "),s("code",[e._v("apps/v1beta2")]),e._v("are no longer supported and  and have been replaced by "),s("code",[e._v("apps/v1")]),e._v(".")]),e._v(" "),s("p",[e._v("Currently Mojaloop helm charts (as of v8.4.x) refer to deprecated ids, therefore it's not possible to install current Mojaloop charts on Kubernetes version above 1.15 without manually changing charts.")]),e._v(" "),s("p",[e._v("Refer to the following issue for more info: "),s("a",{attrs:{href:"https://github.com/mojaloop/helm/issues/219",target:"_blank",rel:"noopener noreferrer"}},[e._v("mojaloop/helm#219"),s("OutboundLink")],1)]),e._v(" "),s("h4",{attrs:{id:"fixes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fixes"}},[e._v("#")]),e._v(" Fixes")]),e._v(" "),s("p",[e._v("Ensure that you are deploying the Mojaloop Helm charts on v1.15 of Kubernetes (or microk8s when working locally).")]),e._v(" "),s("h4",{attrs:{id:"additional-details-for-microk8s-fix"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#additional-details-for-microk8s-fix"}},[e._v("#")]),e._v(" Additional details for "),s("code",[e._v("microk8s")]),e._v(" fix")]),e._v(" "),s("p",[e._v("To check version of "),s("code",[e._v("microk8s")]),e._v(":")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("snap info microk8s\n")])])]),s("p",[s("em",[e._v('Note: Look at the end of the output for a row starting with "installed"')])]),e._v(" "),s("p",[e._v("To install most recent supported version:")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("snap refresh microk8s --channel"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1.15")]),e._v("/stable --classic\n")])])]),s("h2",{attrs:{id:"_2-deployment-issues"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-deployment-issues"}},[e._v("#")]),e._v(" 2. Deployment issues")]),e._v(" "),s("h3",{attrs:{id:"_2-1-microk8s-helm-init-connection-refused"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-microk8s-helm-init-connection-refused"}},[e._v("#")]),e._v(" 2.1. MicroK8s - helm init connection refused"),s("a",{attrs:{name:"helm_init_connection_refused"}})]),e._v(" "),s("h4",{attrs:{id:"description-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#description-2"}},[e._v("#")]),e._v(" Description")]),e._v(" "),s("p",[e._v("The helm init:")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("helm init\n")])])]),s("p",[e._v("fails with error when installing locally on "),s("code",[e._v("microk8s")]),e._v(":")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Error: error installing: Post http://localhost:8080/apis/apps/v1/namespaces/kube-system/deployments: dial tcp 127.0.0.1:8080: connect: connection refused\n")])])]),s("h4",{attrs:{id:"reason-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reason-2"}},[e._v("#")]),e._v(" Reason")]),e._v(" "),s("p",[e._v("This may be a missing  "),s("code",[e._v("~/.kube/config")]),e._v(" file, where helm looks for connection details.")]),e._v(" "),s("h4",{attrs:{id:"fix-option-1"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fix-option-1"}},[e._v("#")]),e._v(" Fix - option #1")]),e._v(" "),s("p",[e._v("One of the solutions is to generate that file by issuing:")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("microk8s.kubectl config view --raw "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token environment constant"}},[e._v("$HOME")]),e._v("/.kube/config\n")])])]),s("h4",{attrs:{id:"fix-option-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fix-option-2"}},[e._v("#")]),e._v(" Fix - option #2")]),e._v(" "),s("p",[e._v("Another option is to export the config to a new file:")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("microk8s.kubectl config view --raw "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token environment constant"}},[e._v("$HOME")]),e._v("/.kube/local.config\n")])])]),s("p",[e._v("And then export the following env var:")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("KUBECONFIG")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token environment constant"}},[e._v("$HOME")]),e._v("/.kube/local.config\n")])])]),s("h3",{attrs:{id:"_2-2-err-name-not-resolved-error"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-err-name-not-resolved-error"}},[e._v("#")]),e._v(" 2.2. "),s("code",[e._v("ERR_NAME_NOT_RESOLVED")]),e._v(" Error")]),e._v(" "),s("h4",{attrs:{id:"description-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#description-3"}},[e._v("#")]),e._v(" Description")]),e._v(" "),s("p",[e._v("The following error is displayed when attempting to access an end-point (e.g. central-ledger.local) via the Kubernetes Service directly in a browser: "),s("code",[e._v("ERR_NAME_NOT_RESOLVED")])]),e._v(" "),s("h4",{attrs:{id:"fixes-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fixes-2"}},[e._v("#")]),e._v(" Fixes")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("Verify that that Mojaloop was deployed by checking that the helm chart(s) was installed by executing:")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("helm list\n")])])]),s("p",[e._v("If the helm charts are not listed, see the "),s("RouterLink",{attrs:{to:"/deployment-guide/#4-helm"}},[e._v("Helm Chart Installation")]),e._v(" section to install a chart.")],1)]),e._v(" "),s("li",[s("p",[e._v("Ensure that all the Mojaloop Pods/Containers have started up correctly and are available through the Kubernetes dashboard.")])]),e._v(" "),s("li",[s("p",[e._v("Note that the Mojaloop deployment via Helm can take a few minutes to initially startup depending on the system's available resources and specification. It is recommended that you wait at least 10m for all Pods/Containers to self heal before troubleshooting.")])])]),e._v(" "),s("h3",{attrs:{id:"_2-3-microk8s-connectivity-issues"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-microk8s-connectivity-issues"}},[e._v("#")]),e._v(" 2.3. MicroK8s - Connectivity Issues")]),e._v(" "),s("h4",{attrs:{id:"description-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#description-4"}},[e._v("#")]),e._v(" Description")]),e._v(" "),s("p",[e._v("My pods can’t reach the internet or each other (but my MicroK8s host machine can).")]),e._v(" "),s("p",[e._v("An example of this is that the Central-Ledger logs indicate that there is an error with the Broker transport as per the following example:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('2019-11-05T12:28:10.470Z - info: Server running at: \n2019-11-05T12:28:10.474Z - info: Handler Setup - Registering {"type":"prepare","enabled":true}!\n2019-11-05T12:28:10.476Z - info: CreateHandler::connect - creating Consumer for topics: [topic-transfer-prepare]\n2019-11-05T12:28:10.515Z - info: CreateHandler::connect - successfully connected to topics: [topic-transfer-prepare]\n2019-11-05T12:30:20.960Z - error: Consumer::onError()[topics=\'topic-transfer-prepare\'] - Error: Local: Broker transport failure)\n')])])]),s("h4",{attrs:{id:"fixes-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fixes-3"}},[e._v("#")]),e._v(" Fixes")]),e._v(" "),s("p",[e._v("Make sure packets to/from the pod network interface can be forwarded to/from the default interface on the host via the iptables tool. Such changes can be made persistent by installing the iptables-persistent package:")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" iptables -P FORWARD ACCEPT\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt-get")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" iptables-persistent\n")])])]),s("p",[e._v("or, if using ufw:")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" ufw default allow routed\n")])])]),s("p",[e._v("The MicroK8s inspect command can be used to check the firewall configuration:")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("microk8s.inspect\n")])])]),s("h2",{attrs:{id:"_3-ingress-issues"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-ingress-issues"}},[e._v("#")]),e._v(" 3. Ingress issues")]),e._v(" "),s("h3",{attrs:{id:"_3-1-ingress-rules-are-not-resolving-for-nginx-ingress-v0-22-or-later"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-ingress-rules-are-not-resolving-for-nginx-ingress-v0-22-or-later"}},[e._v("#")]),e._v(" 3.1. Ingress rules are not resolving for Nginx Ingress v0.22 or later")]),e._v(" "),s("h4",{attrs:{id:"description-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#description-5"}},[e._v("#")]),e._v(" Description")]),e._v(" "),s("p",[e._v("Ingress rules are unable to resolve to the correct path based on the annotations specified in the values.yaml configuration files when using Nginx Ingress controllers v0.22 or later.")]),e._v(" "),s("p",[e._v("This is due to the changes introduced in Nginx Ingress controllers that are v0.22 or later as per the following link: https://kubernetes.github.io/ingress-nginx/examples/rewrite/#rewrite-target.")]),e._v(" "),s("h4",{attrs:{id:"fixes-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fixes-4"}},[e._v("#")]),e._v(" Fixes")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("Make the following change to all Ingress annotations (from --\x3e to) in each of the values.yaml files:")]),e._v(" "),s("p",[s("code",[e._v("nginx.ingress.kubernetes.io/rewrite-target: '/'")]),e._v(" --\x3e "),s("code",[e._v("nginx.ingress.kubernetes.io/rewrite-target: '/$1'")])])])]),e._v(" "),s("h3",{attrs:{id:"_3-2-ingress-rules-are-not-resolving-for-nginx-ingress-earlier-than-v0-22"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-ingress-rules-are-not-resolving-for-nginx-ingress-earlier-than-v0-22"}},[e._v("#")]),e._v(" 3.2. Ingress rules are not resolving for Nginx Ingress earlier than v0.22")]),e._v(" "),s("h4",{attrs:{id:"description-6"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#description-6"}},[e._v("#")]),e._v(" Description")]),e._v(" "),s("p",[e._v("Ingress rules are unable to resolve to the correct path based on the annotations specified in the values.yaml configuration files when using Nginx Ingress controllers that are older than v0.22.")]),e._v(" "),s("p",[e._v("This is due to the changes introduced in Nginx Ingress controllers that are v0.22 or later as per the following link: https://kubernetes.github.io/ingress-nginx/examples/rewrite/#rewrite-target.")]),e._v(" "),s("h4",{attrs:{id:"fixes-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fixes-5"}},[e._v("#")]),e._v(" Fixes")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("Make the following change to all Ingress annotations (from --\x3e to) in each of the values.yaml files:")]),e._v(" "),s("p",[s("code",[e._v("nginx.ingress.kubernetes.io/rewrite-target: '/$1'")]),e._v(" --\x3e "),s("code",[e._v("nginx.ingress.kubernetes.io/rewrite-target: '/'")])])])])])}),[],!1,null,null,null);t.default=r.exports}}]);